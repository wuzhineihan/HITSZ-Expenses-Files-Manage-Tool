# 自动监控使用说明

## 功能介绍

自动监控系统会实时监测 `社团报销.xlsx` 文件的变化,当你保存Excel文件后,会自动执行 `create_folders.py` 脚本,无需手动运行。

## 使用方法

### 方法一:双击启动(推荐) 🖱️

1. 双击 `启动自动监控.bat` 文件
2. 会弹出一个黑色的命令行窗口
3. 看到"监控已启动"的提示后,就可以开始编辑Excel了
4. 每次保存Excel文件,窗口中会显示执行进度
5. 关闭窗口或按 `Ctrl+C` 可停止监控

### 方法二:命令行启动

```bash
python auto_watch.py
```

## 工作流程

### 智能等待模式 ✨

系统会智能检测Excel文件是否被关闭:

```
1. 打开Excel → 2. 修改数据 → 3. 保存(Ctrl+S) → 监控检测到变化
                        ↑                              ↓
                        |                         检查文件是否关闭?
                        |                              ↓
                        |                    是 → 立即执行脚本 → 查看结果
                        |                              ↓
                        └─────── 继续编辑 ←────────────┘
                        
如果文件未关闭(仍在Excel中打开):
保存 → 检测到变化 → 等待文件关闭(最多60秒) → 关闭Excel → 自动执行
```

**优势:**
- ✅ 不会因为文件被占用而执行失败
- ✅ 等待关闭后再执行,确保能正确更新唯一ID
- ✅ 智能等待,无需手动操作

## 示例输出

启动后的窗口会显示类似这样的内容:

```
============================================================
📂 社团报销自动化监控系统
============================================================
📁 监控目录: C:\Users\Dau\Desktop\社团报销
📊 监控文件: 社团报销.xlsx
🔧 执行脚本: create_folders.py
============================================================

✅ 监控已启动!
💡 提示: 每次保存Excel文件后会自动执行脚本
⚠️  按 Ctrl+C 可以停止监控

============================================================
📝 检测到Excel文件变化: 社团报销.xlsx
⏰ 时间: 2025-11-17 14:30:25
============================================================

🚀 正在执行文件夹创建脚本...

📌 第 2 行使用现有ID: 1763359655913_7861
使用现有文件夹: 张大佑\30天开发结题证书打印
  - 文件夹 张大佑\30天开发结题证书打印 中有 1 个文件 (当前状态: no)
  - 文件数量不足3个,将材料准备列设置为 no
...

✅ 执行完成!

============================================================
👀 继续监控文件变化...
```

## 注意事项

⚠️ **重要提示:**

1. **监控窗口必须保持打开**
   - 关闭窗口会停止自动监控
   - 可以最小化窗口,但不要关闭

2. **智能等待Excel关闭** ✨
   - 保存后如果文件仍在Excel中打开,系统会等待你关闭文件
   - 最长等待60秒,关闭Excel后会自动执行
   - 两种使用方式都可以:
     - 方式A: 修改 → 保存 → 关闭Excel → (自动执行)
     - 方式B: 修改 → 保存 → 继续编辑 → ... → 最后关闭 → (自动执行)

3. **避免频繁保存**
   - 系统有2秒的冷却时间,防止重复触发
   - 建议修改完一批数据后再保存

4. **Excel文件更新提示**
   - 因为脚本会更新Excel文件(添加唯一ID等)
   - 如果Excel已关闭,下次打开会看到最新数据
   - 如果Excel仍打开,可能会提示"文件已被修改",点击"是"重新加载即可

## 优点

✅ **解放双手**: 不用手动运行脚本
✅ **实时更新**: 保存后立即看到结果
✅ **提高效率**: 专注于数据录入,自动处理后续操作
✅ **错误提示**: 出错时立即显示,方便调试

## 何时使用

### 适合使用自动监控:
- 📝 批量录入大量数据时
- 🔄 需要频繁修改和测试时
- ⚡ 希望实时看到文件夹变化时

### 不需要使用自动监控:
- 📊 只查看或分析数据时(不修改)
- 💾 偶尔更新一两条记录时
- 🎯 完成所有修改后再统一处理时

## 停止监控

### 方法1: 关闭窗口
直接点击窗口右上角的 ❌ 关闭按钮

### 方法2: 快捷键
在监控窗口中按 `Ctrl+C`

### 方法3: 任务管理器
如果窗口无响应,可以在任务管理器中结束 `python.exe` 进程

## 常见问题

### Q: 为什么保存后没有自动执行?
**A:** 可能的原因:
1. 监控窗口已关闭
2. Excel文件名不是"社团报销.xlsx"
3. 在其他目录打开的Excel文件

### Q: 可以监控多个Excel文件吗?
**A:** 当前版本只监控"社团报销.xlsx",如需监控其他文件,需要修改 `auto_watch.py` 中的配置

### Q: 影响电脑性能吗?
**A:** 几乎不影响,监控脚本占用资源很少,只在文件变化时才执行

### Q: 可以后台运行吗?
**A:** 可以最小化窗口到任务栏,监控会继续工作

## 高级配置

如需修改配置,编辑 `auto_watch.py` 文件:

```python
# 在main()函数中修改这些配置
excel_file = '社团报销.xlsx'  # Excel文件名
script_file = 'create_folders.py'  # 要执行的脚本
```

```python
# 在ExcelFileHandler类中修改
self.cooldown = 2  # 冷却时间(秒),避免重复触发
```

## 与手动运行的对比

| 功能 | 自动监控 | 手动运行 |
|------|----------|----------|
| 便捷性 | ⭐⭐⭐⭐⭐ 保存即执行 | ⭐⭐⭐ 需要手动运行 |
| 实时性 | ⭐⭐⭐⭐⭐ 立即执行 | ⭐⭐⭐ 何时运行自己决定 |
| 资源占用 | ⭐⭐⭐⭐ 持续运行 | ⭐⭐⭐⭐⭐ 用时才运行 |
| 适用场景 | 频繁修改 | 偶尔更新 |

## 建议工作流程

### 场景1: 批量录入新数据(推荐工作流)
1. 🚀 启动自动监控
2. 📝 打开Excel,逐行录入数据
3. 💾 保存数据(Ctrl+S)
4. � 继续编辑下一批数据
5. � 再次保存
6. 📝 继续编辑...
7. ✅ 完成所有录入后,关闭Excel
8. 🎯 系统检测到文件关闭,自动执行脚本
9. 👀 在监控窗口查看执行结果
10. ⏹️ 完成后关闭监控

**优势**: 可以专注于数据录入,不用频繁等待脚本执行

### 场景2: 日常维护
1. 📝 直接打开Excel修改
2. 💾 保存Excel
3. 🖱️ 手动运行 `python create_folders.py`
4. ✅ 完成

**推荐**: 大批量操作用自动监控,偶尔修改用手动运行
