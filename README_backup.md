# 社团报销文件夹自动化管理系统# 社团报销文件夹自动化管理系统



[![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)](https://www.python.org/)[![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)](https://www.python.org/)

[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)



一个智能的报销文件夹管理系统,自动创建文件夹、追踪文件、管理报销流程。支持自动监控、智能重命名、文件数量检测等功能。一个智能的报销文件夹管理系统,自动创建文件夹、追踪文件、管理报销流程。



## 📋 目录## 📋 目录



- [核心功能](#核心功能)- [核心功能](#核心功能)

- [快速开始](#快速开始)- [快速开始](#快速开始)

- [使用方法](#使用方法)- [使用方法](#使用方法)

- [智能等待功能](#智能等待功能)- [自动监控功能](#自动监控功能)

- [主要操作](#主要操作)- [智能等待功能](#智能等待功能)

- [文件说明](#文件说明)- [文件说明](#文件说明)

- [使用场景示例](#使用场景示例)- [常见问题](#常见问题)

- [常见问题](#常见问题)- [使用场景示例](#使用场景示例)

- [注意事项](#注意事项)- [注意事项](#注意事项)



------



## 核心功能## 核心功能



### 1. 📁 自动创建文件夹这是一个智能的报销文件夹管理系统,具有以下功能:

- 根据Excel中的"付款人"和"开票内容"自动创建文件夹结构

- 例如: `付款人=张大佑, 开票内容=打印证书` → 创建 `张大佑/打印证书/`### 1. 自动创建文件夹

- 根据 Excel 文件中的"付款人"和"开票内容"自动创建对应的文件夹结构

### 2. 🔄 智能重命名- 例如: 付款人=张大佑, 开票内容=打印30天结题证书 → 创建 `张大佑/打印30天结题证书` 文件夹

- 修改Excel中的内容,文件夹自动重命名

- 保留文件夹中的所有文件### 2. 智能元数据管理 ✨ (新功能)

- 不会创建重复文件夹- 为每一行数据创建唯一的元数据标识

- 元数据存储在 `folder_metadata.json` 文件中

### 3. 📊 文件数量检测- 记录每一行对应的文件夹路径

自动检测每个文件夹中的文件数量并更新状态:

- 文件数 < 3 → `no` (材料不足)### 3. 自动重命名功能 ✨ (新功能)

- 文件数 ≥ 3 且状态不是`yes` → `check` (需要审核)- 当你修改 Excel 中的"开票内容"时,脚本会:

- 文件数 ≥ 3 且状态是`yes` → 保持`yes`  - 自动识别这是同一条记录(通过行索引)

  - 将原来的文件夹重命名为新的名称

### 4. 🔍 唯一ID追踪系统  - 保留文件夹中的所有文件

- 为每一行数据生成唯一ID  - **不会创建新的文件夹!**

- 支持新增、修改、删除行

- 智能匹配现有记录**示例:**

- 原来: `张大佑/打印30天结题证书`

### 5. 🗑️ 智能删除- 修改 Excel 中的"开票内容"为: "打印60天结题证书"

- 删除Excel行后,空文件夹自动删除- 运行脚本后: 文件夹自动重命名为 `张大佑/打印60天结题证书`

- 有文件的文件夹自动保留(防止误删)- 文件夹中的文件保持不变!

- 空的付款人文件夹也会被清理

### 4. 自动检测文件数量

### 6. 👁️ 自动监控 (推荐)- 检测每个文件夹中的文件数量

- 实时监控Excel文件变化- 自动更新 Excel 中的"材料准备"列:

- 保存后自动执行脚本  - 文件数 < 3: 设置为 `no` (材料不足)

- 智能等待Excel关闭后再执行  - 文件数 ≥ 3 且状态不是 `yes`: 设置为 `check` (需要人工检查)

  - 文件数 ≥ 3 且状态是 `yes`: 保持 `yes` 不变

---

## 使用方法

## 快速开始

### 方式一:自动监控(推荐) 🎯

### 安装依赖

**适合频繁修改Excel时使用**

```bash

pip install pandas openpyxl watchdog1. 双击运行 `启动自动监控.bat`

```2. 保持监控窗口打开(可最小化)

3. 正常编辑和保存Excel文件

### 第一次使用4. 每次保存后会自动执行脚本

5. 完成后关闭监控窗口

1. 将 `社团报销.xlsx` 放在工作目录

2. 双击运行 `启动自动监控.bat` (推荐) 或 `运行一次.bat`详细说明请查看: [自动监控说明.md](自动监控说明.md)

3. 系统会自动:

   - 创建所有文件夹### 方式二:手动运行

   - 添加"唯一ID"列到Excel

   - 生成元数据文件**适合偶尔更新时使用**

   - 检测文件数量并更新状态

```bash

---python create_folders.py

```

## 使用方法

### 第一次运行

### 方式一:自动监控(推荐) 🎯无论使用哪种方式,第一次运行会:

- 创建所有文件夹

**适合频繁修改Excel时使用**- 在 Excel 中自动添加"唯一ID"列

- 为每一行生成唯一ID

#### 启动方法- 生成 `folder_metadata.json` 元数据文件

- 更新 Excel 文件中的"材料准备"列

**选项1: 双击启动** (最简单)

```### 修改开票内容后运行

双击 → 启动自动监控.bat1. 在 Excel 中修改某一行的"开票内容"(不要修改"唯一ID"列!)

```2. 保存 Excel 文件

3. 再次运行脚本:

**选项2: 命令行启动**```bash

```bashpython create_folders.py

python auto_watch.py```

```4. 脚本会自动识别变化并重命名对应的文件夹



#### 工作流程### 添加新行 ✨

1. 直接在 Excel 中添加新行(付款人和开票内容)

```2. **不需要填写"唯一ID"列**,留空即可

1. 启动监控(保持窗口打开)3. 运行脚本:

   ↓   - 自动为新行生成唯一ID

2. 打开Excel,编辑数据   - 创建对应的文件夹

   ↓   - 保存元数据

3. 保存Excel (Ctrl+S)

   ↓### 删除行 ✨

4. 继续编辑... (可选)1. 在 Excel 中删除某一行

   ↓2. 保存 Excel 文件

5. 关闭Excel3. 运行脚本:

   ↓   - 自动检测已删除的记录

6. 🎯 系统自动执行脚本   - **空文件夹会被自动删除**

   ↓   - **有文件的文件夹会被保留**(防止误删)

7. 查看监控窗口中的结果   - 显示文件夹状态和文件数量

```   - 元数据中标记为已删除(可恢复)



#### 监控窗口示例## 文件说明



```- `社团报销.xlsx` - Excel 数据源文件

============================================================- `create_folders.py` - 主程序脚本

📂 社团报销自动化监控系统- `auto_watch.py` - 自动监控脚本 ✨

============================================================- `启动自动监控.bat` - 一键启动监控 ✨

📁 监控目录: C:\Users\Dau\Desktop\社团报销- `folder_metadata.json` - 元数据文件(自动生成,请勿手动修改)

📊 监控文件: 社团报销.xlsx- 各文件夹 - 存储对应报销材料的文件

🔧 执行脚本: create_folders.py- `README.md` - 主要说明文档

============================================================- `自动监控说明.md` - 自动监控详细说明 ✨

- `使用场景示例.md` - 各种使用场景的详细示例

✅ 监控已启动!

💡 提示: 每次保存Excel文件后会自动执行脚本## 注意事项

⚠️  按 Ctrl+C 可以停止监控

```⚠️ **重要提示:**

1. **不要手动修改或删除 Excel 中的"唯一ID"列!** 这是系统识别每一行的关键

#### 停止监控2. 不要手动删除或修改 `folder_metadata.json` 文件

3. 不要手动重命名已创建的文件夹,应通过修改 Excel 后运行脚本来重命名

- 关闭监控窗口4. **删除行后,空文件夹会被自动删除,有文件的文件夹会被保留**

- 或按 `Ctrl+C`5. 如果元数据文件损坏,删除它后重新运行脚本会重新创建



### 方式二:手动运行## 唯一ID系统



**适合偶尔更新时使用**系统使用"唯一ID"列来追踪每一行记录:



#### 运行方法- **自动生成**: 新增行时留空,脚本会自动生成唯一ID

- **持久化**: 即使修改"开票内容"或"付款人",只要ID不变,就会识别为同一条记录

**选项1: 双击运行**- **智能匹配**: 如果ID丢失,系统会尝试通过付款人和内容匹配现有记录

```- **删除检测**: 通过对比Excel和元数据中的ID,检测被删除的记录

双击 → 运行一次.bat

```## 工作流程建议



**选项2: 命令行**1. 在 Excel 中记录报销信息

```bash2. 运行脚本创建/更新文件夹

python create_folders.py3. 将报销材料(发票、截图等)放入对应文件夹

```4. 再次运行脚本检查材料收集进度

5. 状态为 `check` 的条目需要人工审核

---6. 审核通过后手动将 Excel 中的状态改为 `yes`



## 智能等待功能## 状态说明



### 功能说明- `no` - 材料不足(文件数 < 3)

- `check` - 需要检查(文件数 ≥ 3,但未审核)

系统会智能检测Excel文件是否被关闭,避免文件被占用导致执行失败。- `yes` - 已确认通过(人工标记)


### 工作模式

#### 模式A: 保存即关闭 (立即执行)

```
编辑Excel → 保存(Ctrl+S) → 关闭Excel
                              ↓
                         检测到关闭
                              ↓
                         立即执行脚本
                              ↓
                         完成!
```

⏱️ **执行时机**: 关闭Excel后立即执行

#### 模式B: 保存后继续编辑 (延迟执行)

```
打开Excel
   ↓
修改 → 保存 → 继续修改 → 保存 → 关闭Excel
       ↓               ↓          ↓
   等待关闭...     等待关闭...  立即执行!
```

⏱️ **执行时机**: 最后关闭Excel时才执行
✅ **优势**: 可以连续编辑,不用每次等待

### 等待提示

当文件被占用时,监控窗口会显示:

```
⏳ 检测到Excel文件正在使用中,等待文件关闭...
💡 提示: 请在Excel中关闭文件后,脚本会自动执行

⏳ 仍在等待... (5/60秒)
⏳ 仍在等待... (10/60秒)

[你关闭了Excel]

✅ 文件已关闭 (等待了 12 秒)
🚀 正在执行文件夹创建脚本...
```

---

## 主要操作

### 新增记录

1. 在Excel末尾添加新行
2. 填写"付款人"和"开票内容"
3. **"唯一ID"列留空**(系统自动生成)
4. 保存Excel(如使用监控)或运行脚本
5. 结果:
   - ✅ 自动生成唯一ID
   - ✅ 创建对应文件夹
   - ✅ 保存元数据

### 修改记录

1. 在Excel中修改"开票内容"或"付款人"
2. **不要修改"唯一ID"列!**
3. 保存Excel(如使用监控)或运行脚本
4. 结果:
   - ✅ 文件夹自动重命名
   - ✅ 文件夹中的文件保留
   - ✅ 元数据自动更新

### 删除记录

1. 在Excel中删除某一行
2. 保存Excel(如使用监控)或运行脚本
3. 结果:
   - ✅ 空文件夹自动删除
   - ⚠️ 有文件的文件夹保留并提示
   - ✅ 空的付款人文件夹也被删除
   - ✅ 元数据标记为已删除

---

## 文件说明

### 主要文件

| 文件名 | 说明 | 是否必需 |
|--------|------|---------|
| `社团报销.xlsx` | Excel数据源 | ✅ 必需 |
| `create_folders.py` | 主程序脚本 | ✅ 必需 |
| `auto_watch.py` | 自动监控脚本 | ⭐ 推荐 |
| `启动自动监控.bat` | 一键启动监控 | ⭐ 推荐 |
| `运行一次.bat` | 手动运行一次 | 可选 |
| `folder_metadata.json` | 元数据(自动生成) | 🚫 勿修改 |

### 文件夹结构

```
社团报销/
├── 社团报销.xlsx           # Excel数据源
├── create_folders.py       # 主程序
├── auto_watch.py          # 监控脚本
├── 启动自动监控.bat       # 启动文件
├── 运行一次.bat           # 手动运行
├── folder_metadata.json   # 元数据
├── README.md             # 本文档
│
├── 张大佑/               # 付款人文件夹
│   ├── 打印证书/         # 开票内容文件夹
│   │   ├── 发票.pdf
│   │   ├── 截图.png
│   │   └── 证明.jpg
│   └── 购买设备/
│       └── ...
│
└── 李明/
    └── ...
```

---

## 使用场景示例

### 场景1: 批量录入新数据

**步骤:**
1. 🚀 启动自动监控
2. 📝 打开Excel,逐行录入数据
3. 💾 保存Excel
4. 📝 继续录入下一批
5. 💾 保存Excel
6. ✅ 完成所有录入后关闭Excel
7. 🎯 系统自动执行脚本
8. 👀 查看监控窗口确认结果

**优势:** 专注于数据录入,不用频繁等待

### 场景2: 修改开票内容(重命名文件夹)

**步骤:**
1. Excel中有一行: `付款人=张大佑, 开票内容=打印30天证书`
2. 修改为: `付款人=张大佑, 开票内容=打印60天证书`
3. **保持唯一ID不变**
4. 保存Excel并关闭(如使用监控)
5. 结果:
   ```
   📝 重命名文件夹:
      从: 张大佑\打印30天证书
      到: 张大佑\打印60天证书
   ```

### 场景3: 删除不需要的记录

**步骤:**
1. 在Excel中删除某一行
2. 保存Excel并关闭(如使用监控)
3. 结果 - 情况A(文件夹为空):
   ```
   🗑️ 检测到 1 个已删除的记录:
      ID: xxx
      付款人: 张大佑
      开票内容: 测试项目
      ✅ 文件夹为空,已删除
   ```
4. 结果 - 情况B(文件夹有文件):
   ```
   🗑️ 检测到 1 个已删除的记录:
      ID: xxx
      付款人: 张大佑
      开票内容: 打印证书
      ⚠️ 文件夹中还有 3 个文件,已保留
   ```

### 场景4: 唯一ID丢失(智能恢复)

**步骤:**
1. 不小心删除了"唯一ID"列
2. 运行脚本
3. 结果:
   ```
   🔗 第 3 行找到匹配的记录,使用ID: xxx
   使用现有文件夹: 张大佑\打印招新传单
   ```
   - ✅ 系统自动恢复唯一ID
   - ✅ 继续使用原文件夹

---

## 常见问题

### Q: 为什么要等文件关闭才执行?

**A:** 当Excel打开文件时,文件被锁定,脚本无法:
- 正确读取最新数据
- 添加或更新"唯一ID"列
- 保存修改后的Excel

等待文件关闭后执行,确保操作成功。

### Q: 可以手动修改唯一ID吗?

**A:** ❌ 不建议!唯一ID是系统识别记录的关键,修改可能导致:
- 系统认为是新记录,创建新文件夹
- 原文件夹变成"孤儿"

### Q: 删除行后又想恢复怎么办?

**A:** 
1. 如果文件夹还在,直接在Excel中重新添加这一行(留空唯一ID)
2. 运行脚本,系统会智能匹配现有文件夹
3. 自动生成新ID并关联

### Q: 可以在Excel中调整行的顺序吗?

**A:** ✅ 完全可以!唯一ID跟着行移动,系统通过ID识别,不依赖行号。

### Q: 为什么保存后没有自动执行?

**A:** 可能的原因:
1. 监控窗口已关闭
2. 文件仍在Excel中打开(检查监控窗口,会显示"等待文件关闭")
3. Excel文件名不是"社团报销.xlsx"

### Q: 多人协作时会有冲突吗?

**A:** ⚠️ 需要注意:
- 每人修改不同的行 → 没问题
- 多人同时修改同一行 → 以最后保存的为准
- 建议协调好,避免同时编辑同一条记录

---

## 注意事项

### ⚠️ 重要提示

1. **不要手动修改"唯一ID"列**
   - 这是系统识别每一行的关键
   - 修改会导致系统无法正确追踪

2. **不要手动修改元数据文件**
   - `folder_metadata.json` 由系统自动管理
   - 手动修改可能导致数据错误

3. **不要手动重命名文件夹**
   - 应通过修改Excel后运行脚本来重命名
   - 手动重命名会导致系统无法追踪

4. **删除行的影响**
   - 空文件夹会被自动删除
   - 有文件的文件夹会被保留
   - 可以手动清理后再次运行

5. **监控窗口的使用**
   - 使用自动监控时,窗口必须保持打开
   - 可以最小化,但不要关闭
   - 关闭窗口会停止监控

### 📊 状态说明

| 状态 | 含义 | 触发条件 |
|------|------|----------|
| `no` | 材料不足 | 文件数 < 3 |
| `check` | 需要检查 | 文件数 ≥ 3,但未审核 |
| `yes` | 已确认通过 | 人工审核后标记 |

### 🔄 工作流程建议

1. 📝 在Excel中记录报销信息
2. 🚀 运行脚本创建/更新文件夹
3. 📂 将报销材料放入对应文件夹
4. 🔍 再次运行脚本检查材料收集进度
5. ✅ 状态为`check`的需人工审核
6. 🎯 审核通过后手动将状态改为`yes`

---

## 效率提升

### 之前的工作流程:

```
编辑 → 保存 → 关闭 → 运行脚本 → 等待 → 打开 → 编辑 → ...
       ↑________需要等待每次执行________↑
```

⏱️ 每次修改都要等待

### 现在的工作流程(使用自动监控):

```
编辑 → 保存 → 编辑 → 保存 → 编辑 → 关闭 → 自动执行
       ↑_____可以连续编辑,不需要等待_____↑    ↑
                                            只等一次!
```

⏱️ 只需要在最后等待一次

**效率提升**: 多次修改场景下可节省大量等待时间!

---

## 技术栈

- **Python 3.7+**: 主要编程语言
- **pandas**: Excel文件读写
- **openpyxl**: Excel操作库
- **watchdog**: 文件监控
- **pathlib**: 文件路径处理

---

## 更新日志

### v2.0 (2025-11-17)
- ✨ 新增自动监控功能
- ✨ 新增智能等待Excel关闭功能
- ✨ 新增智能删除空文件夹功能
- ✨ 新增唯一ID追踪系统
- 🐛 修复Windows命令行编码问题
- 📝 完善文档说明

### v1.0 (2025-11-17)
- 🎉 首次发布
- ✨ 基础文件夹创建功能
- ✨ 文件数量检测功能
- ✨ 智能重命名功能

---

**享受自动化的便利!** 🎉
