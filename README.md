# 社团报销文件夹自动化管理系统

## 功能说明

这是一个智能的报销文件夹管理系统,具有以下功能:

### 1. 自动创建文件夹
- 根据 Excel 文件中的"付款人"和"开票内容"自动创建对应的文件夹结构
- 例如: 付款人=张大佑, 开票内容=打印30天结题证书 → 创建 `张大佑/打印30天结题证书` 文件夹

### 2. 智能元数据管理 ✨ (新功能)
- 为每一行数据创建唯一的元数据标识
- 元数据存储在 `folder_metadata.json` 文件中
- 记录每一行对应的文件夹路径

### 3. 自动重命名功能 ✨ (新功能)
- 当你修改 Excel 中的"开票内容"时,脚本会:
  - 自动识别这是同一条记录(通过行索引)
  - 将原来的文件夹重命名为新的名称
  - 保留文件夹中的所有文件
  - **不会创建新的文件夹!**

**示例:**
- 原来: `张大佑/打印30天结题证书`
- 修改 Excel 中的"开票内容"为: "打印60天结题证书"
- 运行脚本后: 文件夹自动重命名为 `张大佑/打印60天结题证书`
- 文件夹中的文件保持不变!

### 4. 自动检测文件数量
- 检测每个文件夹中的文件数量
- 自动更新 Excel 中的"材料准备"列:
  - 文件数 < 3: 设置为 `no` (材料不足)
  - 文件数 ≥ 3 且状态不是 `yes`: 设置为 `check` (需要人工检查)
  - 文件数 ≥ 3 且状态是 `yes`: 保持 `yes` 不变

## 使用方法

### 第一次运行
```bash
python create_folders.py
```
- 会创建所有文件夹
- 在 Excel 中自动添加"唯一ID"列
- 为每一行生成唯一ID
- 生成 `folder_metadata.json` 元数据文件
- 更新 Excel 文件中的"材料准备"列

### 修改开票内容后运行
1. 在 Excel 中修改某一行的"开票内容"(不要修改"唯一ID"列!)
2. 保存 Excel 文件
3. 再次运行脚本:
```bash
python create_folders.py
```
4. 脚本会自动识别变化并重命名对应的文件夹

### 添加新行 ✨
1. 直接在 Excel 中添加新行(付款人和开票内容)
2. **不需要填写"唯一ID"列**,留空即可
3. 运行脚本:
   - 自动为新行生成唯一ID
   - 创建对应的文件夹
   - 保存元数据

### 删除行 ✨
1. 在 Excel 中删除某一行
2. 保存 Excel 文件
3. 运行脚本:
   - 自动检测已删除的记录
   - **所有文件夹都会保留**(无论是否为空)
   - 显示文件夹状态和文件数量
   - 元数据中标记为已删除(可恢复)
   - 如需删除文件夹,请手动操作

## 文件说明

- `社团报销.xlsx` - Excel 数据源文件
- `create_folders.py` - 主程序脚本
- `folder_metadata.json` - 元数据文件(自动生成,请勿手动修改)
- 各文件夹 - 存储对应报销材料的文件

## 注意事项

⚠️ **重要提示:**
1. **不要手动修改或删除 Excel 中的"唯一ID"列!** 这是系统识别每一行的关键
2. 不要手动删除或修改 `folder_metadata.json` 文件
3. 不要手动重命名已创建的文件夹,应通过修改 Excel 后运行脚本来重命名
4. **删除行后,文件夹会被保留**(方便之后继续使用或手动整理)
5. 如果元数据文件损坏,删除它后重新运行脚本会重新创建

## 唯一ID系统

系统使用"唯一ID"列来追踪每一行记录:

- **自动生成**: 新增行时留空,脚本会自动生成唯一ID
- **持久化**: 即使修改"开票内容"或"付款人",只要ID不变,就会识别为同一条记录
- **智能匹配**: 如果ID丢失,系统会尝试通过付款人和内容匹配现有记录
- **删除检测**: 通过对比Excel和元数据中的ID,检测被删除的记录

## 工作流程建议

1. 在 Excel 中记录报销信息
2. 运行脚本创建/更新文件夹
3. 将报销材料(发票、截图等)放入对应文件夹
4. 再次运行脚本检查材料收集进度
5. 状态为 `check` 的条目需要人工审核
6. 审核通过后手动将 Excel 中的状态改为 `yes`

## 状态说明

- `no` - 材料不足(文件数 < 3)
- `check` - 需要检查(文件数 ≥ 3,但未审核)
- `yes` - 已确认通过(人工标记)
